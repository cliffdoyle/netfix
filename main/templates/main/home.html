{% extends 'main/base.html' %}

{% block title %}
    NetFix
{% endblock %}

{% block content %}
    <div style="margin-top: 50px;">
        <p class="site_title">NetFix</p>
        <img class="home_logo" src="static/css/logo.png" alt="logo">

        <!-- Link to Most Requested Services -->
        <h1>Most Requested Services</h1>
        <ul>
            {% for service in most_requested_services %}
                <li>
                    <a href="{% url 'services:service_detail' service.id %}">{{ service.name }}</a>
                    - {{ service.field }} - ${{ service.price_hour }} per hour
                    <br>
                    Provided by: <a href="{% url 'users:company_profile' username=service.company.user.username %}">{{ service.company.user.username }}</a>
                    <br>
                    Requests: {{ service.request_count }}
                </li>
            {% empty %}
                <p>No services have been requested yet.</p>
            {% endfor %}
        </ul>

         <!-- Dropdown for category selection -->
         <form method="get" class="filter-form">
            <label for="field">Filter by Category:</label>
            <select name="field" id="field" onchange="this.form.submit()">
                <option value="">All Categories</option>
                {% for field in fields %}
                    <option value="{{ field }}" {% if field == selected_field %}selected{% endif %}>{{ field }}</option>
                {% endfor %}
            </select>
        </form>

        <!-- Display services for selected category -->
        {% if selected_field %}
            <h2>Services in {{ selected_field }}</h2>
            <div class="service-list">
                {% if services %}
                    {% for service in services %}
                        <div class="service-item">
                            <h3>{{ service.name }}</h3>
                            <p>{{ service.description|truncatewords:20 }}</p>
                            <p><strong>Price/hour:</strong> ${{ service.price_hour }}</p>
                            <p><strong>Rating:</strong> {{ service.rating }}/5</p>
                            <p><strong>Company:</strong> {{ service.company.user.username }}</p>
                            <a href="{% url 'services:service_detail' service.id %}">View Details</a>
                        </div>
                    {% endfor %}
                {% else %}
                    <p>No services available in this category yet.</p>
                {% endif %}
            </div>
        {% endif %}
    </div>
{% endblock %}
